<div class="d-flex justify-content-between align-items-center">
  <h3 class="mb-0 lh-1">{{ speaker.lastName | titlecase }}, {{ speaker.firstName | titlecase }} <br>
    <a [href]="'mailto:' + speaker.email" class="btn-link mt-0 fs-6 fw-normal">{{ speaker.email }}</a>
  </h3>
  <img [src]="speaker.photoURL ? speaker.photoURL : '../assets/images/placeholder-pub.jpg' " alt=""
    class="rounded-circle border border-light border-5" style="width: 60px; height: 60px;">
</div>
<hr>
<div class="p-0 mb-3 d-flex flex-wrap align-items-center justify-content-end">
  <div>

    <ng-container *ngIf="isEditing; else editActions">
      <button class="btn btn-light btn-sm d-inline-block me-2" (click)="isEditing = false">
        Cancel
      </button>

      <button class="btn btn-primary btn-sm" (click)="saveDetail()">Save</button>

    </ng-container>

    <ng-template #editActions>

      <button class="btn btn-light btn-sm d-inline-block me-2" (click)="isEditing = true">
        <svg-icon src="assets/images/edit.svg" class="align-middle" [svgStyle]="{ 'width.px': 14 }"></svg-icon>
        <span class="ms-2 align-middle">Edit</span>
      </button>

      <button class="btn btn-light btn-sm btn-delete" [disabled]="authUser && speaker.id == authUser.uid && amIAdmin" (click)="openDeleteAlert()">
        <svg-icon src="assets/images/trash.svg" class="align-middle" [svgStyle]="{ 'width.px': 14 }"></svg-icon>
        <span class="ms-2 align-middle">Delete</span>
      </button>

    </ng-template>
  </div>

</div>


<div class="row g-2">
  <div class="col-lg-4 col-md-6 col-12">
    <div class="form-floating">
      <input type="text" class="form-control" [(ngModel)]="firstName" placeholder="Joe" [value]="firstName"
        [disabled]="!isEditing">
      <label>First Name</label>
    </div>
  </div>
  <div class="col-lg-4 col-md-6 col-sm-12">
    <div class="form-floating">
      <input type="text" class="form-control" [(ngModel)]="lastName" placeholder="Publisher" [value]="lastName"
        [disabled]="!isEditing">
      <label>Last Name</label>
    </div>
  </div>
  <div class="col-lg-4 col-md-6 col-sm-12">
    <div class="form-floating">
      <select class="form-select" [disabled]="!isEditing">
        <option [value]="p" *ngFor="let p of privileges" [selected]="p == privilege">{{ p }}</option>
      </select>
      <label>Privilege</label>
    </div>
  </div>
  <div class="col-12">
    <div class="form-floating">
      <input type="text" class="form-control" [(ngModel)]="congregationName" placeholder="Congregation Name" [value]="congregationName"
        [disabled]="!isEditing">
      <label>Congregation</label>
    </div>
  </div>
</div>

<div class="d-flex justify-content-between align-items-end pt-3">
  <h5 class="fw-bold mb-0">Talks</h5>
  <button class="btn btn-light btn-sm d-inline-block" (click)="addTalk()">
    <svg-icon src="assets/images/add.svg" class="align-middle" [svgStyle]="{ 'width.px': 14 }"></svg-icon>
    <span class="ms-2 align-middle">Add Talk</span>
 </button>
</div>
  <hr>
  <ul *ngIf="talks$ | async as talks" class="list-group list-group-flush mt-3">

    <li class="list-group-item p-2 d-flex justify-content-between align-items-center" *ngFor="let talk of talks | orderBy: 'timeStamp'">
      <ng-container *ngIf="talk.title != null; else addTalk">
        <p class="lh-base mb-0">
          <span class="fw-bold">Title</span> <br>
          <span class="text-muted fs-6 fst-italic">{{ talk.title }}</span>
        </p>
        <button class="btn btn-light btn-sm btn-delete" [disabled]="authUser && speaker.id != authUser.uid" (click)="deleteTalk(talk)">
          <svg-icon src="assets/images/trash.svg" class="align-middle" [svgStyle]="{ 'width.px': 14 }"></svg-icon>
        </button>
      </ng-container>

      <ng-template #addTalk>
        <div *ngIf="allTalks && allTalks.length > 0">
        <ng-template #rt let-r="result" let-t="term">
          <ngb-highlight (click)="saveTalk(r, talk)" [result]="r.title" [term]="t"></ngb-highlight>
        </ng-template>

        <span class="fw-bold">Title</span> <br>
        <div class="input-group-sm pt-2">
          <input type="text" style="width: 400px; max-width: 100%;" class="form-control" [ngbTypeahead]="search" [resultTemplate]="rt"  placeholder="Type talk number or title" [value]=""/>
        </div>

      </div>
        <button class="btn btn-light btn-sm btn-delete ms-2" [disabled]="authUser && speaker.id == authUser.uid" (click)="deleteTalk(talk)">
          <svg-icon src="assets/images/trash.svg" class="align-middle" [svgStyle]="{ 'width.px': 14 }"></svg-icon>
      </button>
      </ng-template>  
    </li>
  </ul>


<ng-template #loading>
  <div class="d-flex justify-content-center align-items-center" style="min-height: 500px;">
    <div class="spinner-border text-success" style="width: 3rem; height: 3rem;" role="status">
    </div>
  </div>
</ng-template>
